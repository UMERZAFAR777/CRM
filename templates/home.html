<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>C.R.M</title>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body.dark-mode {
        background-color: #121212;
        color: white;
      }
      body.light-mode {
        background-color: #f8f9fa;
        color: black;
      }
      .dark-mode .navbar {
        background-color: #212529 !important;
      }
      .dark-mode .navbar .nav-link,
      .dark-mode .navbar-brand {
        color: white !important;
      }
      .light-mode .navbar {
        background-color: #f8f9fa !important;
      }
      .light-mode .navbar .nav-link,
      .light-mode .navbar-brand {
        color: black !important;
      }
      .theme-toggle {
        border-radius: 50px;
        font-size: 14px;
      }
      .dark-mode table {
        color: white;
      }
      .dark-mode thead {
        background-color: #343a40 !important;
        color: white;
      }
      .light-mode thead {
        background-color: #e9ecef !important;
        color: black;
      }
      /* Dark mode table fix */
.dark-mode table {
  background-color: #1e1e1e !important;
  color: white !important;
  border-color: #444;
}

.dark-mode thead {
  background-color: #343a40 !important;
  color: white !important;
}

.dark-mode tbody tr {
  background-color: #2c2c2c !important;
  color: white !important;
}

.dark-mode tbody tr:nth-child(even) {
  background-color: #3a3a3a !important;
}

.dark-mode tbody tr:hover {
  background-color: #4a4a4a !important;
}
/* Light mode table */
.light-mode table {
  background-color: white !important;
  color: black !important;
}

.light-mode thead {
  background-color: #e9ecef !important;
  color: black !important;
}

/* Dark mode table */
.dark-mode table {
  background-color: #1e1e1e !important;
  color: white !important;
  border-color: #444 !important;
}

.dark-mode thead {
  background-color: #343a40 !important;
  color: rgb(0, 0, 0) !important;
}

.dark-mode tbody tr {
  background-color: #2c2c2c !important;
  color: white !important;
}

.dark-mode tbody tr:nth-child(even) {
  background-color: #3a3a3a !important;
}

.dark-mode tbody tr:hover {
  background-color: #4a4a4a !important;
}

      
    </style>
  </head>
  <body class="light-mode">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
      <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="{% url 'home' %}">C.R.M</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" href="{% url 'home' %}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'logout' %}">Logout</a>
            </li>
            
          </ul>
          <div  style="padding-right: 10px;">
          <a class="btn btn-outline-primary theme-toggle" href="{% url 'addstudent' %}">Add Student</a>
          </div>
          <!-- Toggle Button -->
          <button class="btn btn-outline-primary theme-toggle" id="toggleTheme">üåô Dark</button>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      {% if user.is_authenticated %}
        <h1 class="fw-bold text-center">Welcome {{ user.username|capfirst }} üéâ</h1>
      {% endif %}
    </div>
    <br>
    {% if messages %}
            {% for i in messages %}
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
  <strong>{{i}}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
                {% endfor %}
                {% endif %}


   <div class="container mt-5">
  <h2 class="mb-3">Student List</h2>
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle shadow-sm">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>
          <th scope="col">City</th>
          <th scope="col">Phone</th>
          <th scope="col">Email</th>
          <th scope="col" style="min-width:120px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for i in student %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ i.name }}</td>
            <td>{{ i.city }}</td>
            <td>{{ i.phone }}</td>
            <td>{{ i.email }}</td>
            <td>
  {% if user.is_staff or user.is_superuser %}
    <!-- Admin: direct edit link -->
    <a href="{% url 'edit_student' i.id %}"
       style="display:inline-block; padding:6px 12px; border-radius:8px; font-weight:600;
              border:1px solid #0d6efd; background:#0d6efd; color:#fff; text-decoration:none;
              box-shadow:0 1px 3px rgba(0,0,0,.15); transition:filter .15s ease;"
       onmouseover="this.style.filter='brightness(0.9)'"
       onmouseout="this.style.filter='none'">
      Edit
    </a>
  {% else %}
    <!-- Normal user: same looking button but alert on click -->
    <a href="javascript:void(0);"
       onclick="alert('Only admin can edit');"
       style="display:inline-block; padding:6px 12px; border-radius:8px; font-weight:600;
              border:1px solid #6c757d; background:#6c757d; color:#fff; text-decoration:none;
              box-shadow:0 1px 3px rgba(0,0,0,.15); transition:filter .15s ease;">
      Edit
    </a>
  {% endif %}
</td>

          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center">No students found</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>


    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const toggleBtn = document.getElementById("toggleTheme");
      const body = document.body;

      toggleBtn.addEventListener("click", function () {
        body.classList.toggle("dark-mode");
        body.classList.toggle("light-mode");

        if (body.classList.contains("dark-mode")) {
          toggleBtn.textContent = "‚òÄÔ∏è Light";
          toggleBtn.classList.remove("btn-outline-primary");
          toggleBtn.classList.add("btn-outline-warning");
        } else {
          toggleBtn.textContent = "üåô Dark";
          toggleBtn.classList.remove("btn-outline-warning");
          toggleBtn.classList.add("btn-outline-primary");
        }
      });
    </script>
  </body>
</html>
